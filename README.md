# Auth Test Task - выполненное тестовое задание на создание системы аутентификации и авторизации

## Описание

Бэкенд-приложение реализует собственную систему аутентификации и авторизации, не ограничиваясь стандартными решениями фреймворков. Основная задача — спроектировать и реализовать схему контроля доступа, включая структуру базы данных для хранения правил доступа и разрешённых действий пользователей.

На данный момент приложение выдает данные в максимальном объеме, без пагинации и фильтров, чтобы сосредоточиться на логике аутентификации и авторизации, а также не усложнять код.

## Установка и запуск

1. Клонируйте репозиторий:
   ```bash
   git clone git@github.com:un-but/auth-test-task.git
   cd auth-test-task
   ```

2. Настройте пароли и другие переменные в docker-compose.yml.
   Рекомендуется заменить как минимум API_JWT_SECRET.
   Для создания миграции следует переменные из environment в app из docker-compose.yml задать в .env файле,
   и запустить команду:
   ```bash
   poetry run alembic revision --autogenerate -m "Название миграции"
   ```

2. Запустите сервисы через Docker Compose (все миграции применяются автоматически):
   ```bash
   docker-compose up --build
   ```

   Это поднимет контейнеры для приложения, PostgreSQL и Redis.

3. Приложение будет доступно на http://localhost:8000.
   Удобное тестирование доступно через http://localhost:8000/docs с помощью Swagger UI.

> [!WARNING]
> При тестировании учтите, что создание и удаление пользователей не подразумевает удаления токенов,
> для этого есть отдельные эндпоинты в /auth.
> То же самое касается и повторения пароля, подразумевается что это будет реализовано на фронтенде.

## Основные возможности

### 1. Работа с пользователями

- **Регистрация:** Имя, email, пароль (с подтверждением).
- **Редактирование профиля:** Возможность изменить данные.
- **Мягкое удаление:** Пользователь может удалить аккаунт (is_active=False), выйти из системы и не сможет войти снова, но данные сохраняются в базе.
- **Вход/выход:** Аутентификация по email и паролю, идентификация пользователя в последующих запросах.

### 2. Система контроля доступа

- Своя схема хранения ограничений доступа.
- Таблицы для ролей, бизнес-элементов и правил доступа.
- API для просмотра и изменения правил (только для администратора).
- Обработка ошибок:
  - `401 Unauthorized` — пользователь не идентифицирован.
  - `403 Forbidden` — недостаточно прав для доступа.

### 3. Бизнес-объекты

- Моковые представления для демонстрации объектов (без таблиц в БД).
- Возврат списков объектов или ошибок доступа.

## Технологии

- FastAPI + PostgreSQL (рекомендовано)
- bcrypt для паролей
- PyJWT для токенов
- Redis для refresh токенов (через куки)

## Структура базы данных

- **users:** Пользователи (id, is_active, role, name, created_at, email, password)
- **posts:** Посты (id, created_at, content, user_id)
- **comments:** Комментарии (id, created_at, content, user_id, post_id)
- **role_rules:** Правила доступа для ролей и объектов (role, object_type, action, allowed)
